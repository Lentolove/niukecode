package zuoshen.topinterview;

/**
 * Author : tsp
 * Time: 2022/3/11 11:10
 * Desc : å®ç° strStr() å‡½æ•°ã€‚
 * ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸² haystack å’Œ needle ï¼Œè¯·ä½ åœ¨ haystack å­—ç¬¦ä¸²ä¸­æ‰¾å‡º needle å­—ç¬¦ä¸²å‡ºç°çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ã€‚å¦‚
 * æœä¸å­˜åœ¨ï¼Œåˆ™è¿”å› -1 ã€‚
 * <p>
 * è¯´æ˜ï¼šå½“ needle æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬åº”å½“è¿”å›ä»€ä¹ˆå€¼å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªåœ¨é¢è¯•ä¸­å¾ˆå¥½çš„é—®é¢˜ã€‚
 * å¯¹äºæœ¬é¢˜è€Œè¨€ï¼Œå½“ needle æ˜¯ç©ºå­—ç¬¦ä¸²æ—¶æˆ‘ä»¬åº”å½“è¿”å› 0 ã€‚è¿™ä¸ C è¯­è¨€çš„ strstr() ä»¥åŠ Java çš„ indexOf() å®šä¹‰ç›¸ç¬¦ã€‚
 * <p>
 * ç¤ºä¾‹ 1ï¼š
 * è¾“å…¥ï¼šhaystack = "hello", needle = "ll"
 * è¾“å‡ºï¼š2
 * <p>
 * ç¤ºä¾‹ 2ï¼š
 * è¾“å…¥ï¼šhaystack = "aaaaa", needle = "bba"
 * è¾“å‡ºï¼š-1
 * <p>
 * ç¤ºä¾‹ 3ï¼š
 * <p>
 * è¾“å…¥ï¼šhaystack = "", needle = ""
 * è¾“å‡ºï¼š0
 * <p>
 * æç¤ºï¼š
 * <p>
 * 0 <= haystack.length, needle.length <= 5 * 10â´
 * haystack å’Œ needle ä»…ç”±å°å†™è‹±æ–‡å­—ç¬¦ç»„æˆ
 * <p>
 * Related Topics åŒæŒ‡é’ˆ å­—ç¬¦ä¸² å­—ç¬¦ä¸²åŒ¹é… ğŸ‘ 1302 ğŸ‘ 0
 */
public class Problem_0028_ImplementStrStr {

    /**
     * æ ‡å‡†çš„kmpç®—æ³•
     */
    public static int getIndexOf(String s, String m) {
        //1.å¤§çš„è¿‡æ»¤æ¡ä»¶
        if (s == null || m == null ||  s.length() < m.length()) return -1;
        if (m.isEmpty()) return 0;
        char[] str = s.toCharArray();
        char[] match = m.toCharArray();
        //è®¾ç½® str å’Œ match çš„ç§»åŠ¨æŒ‡é’ˆ,å³å½“å‰æ¯”å¯¹åˆ°çš„ä½ç½®
        int x = 0;
        int y = 0;
        //è·å– match å­—ç¬¦æ•°ç»„çš„å‰ç¼€å’Œ
        int[] next = getNextArray(match);
        while (x < str.length && y < match.length) {
            //å¦‚æœå½“å‰å­—ç¬¦ç›¸ç­‰
            if (str[x] == match[y]) {
                x++;
                y++;
            } else if (next[y] == -1) {//ä¸ç›¸ç­‰ï¼Œå°±çœ‹ä¸€ä¸‹nextçš„å‰ç¼€å’Œ
                //2. - 1 è¡¨ç¤º match ä¸­æŒ‡é’ˆå·²ç»èµ°åˆ°å…¶å®ä½ç½®äº†ï¼Œç­‰ä»·äº y == 0,é‚£ç›´æ¥é€‰æ‹©strçš„ä¸‹ä¸€ä¸ªå­—ç¬¦é‡æ–°æ¥
                x++;
            } else {
                //3. kmp ç®—æ³•åŠ é€Ÿçš„åœ°æ–¹ï¼Œæ ¹æ® next çš„å‰ç¼€å’Œæ¥ä¼˜åŒ–yæŒ‡é’ˆçš„ä½ç½®ï¼Œæš´åŠ›æ–¹æ³•ç›´æ¥ä» match[0] ä½ç½®å¼€å§‹åŒ¹é…
                //è€Œä»å‰ç¼€å’Œ a = next[y],å¯çŸ¥ match[0...a-1] éƒ¨åˆ†çš„å­—ç¬¦æ˜¯å’Œ match[y - a ,y -1]å­—ç¬¦æ˜¯ç›¸ç­‰çš„ï¼Œè¿™ä¹Ÿæ˜¯å‰ç¼€å’Œçš„å®šä¹‰æ‰€åœ¨
                //åˆå› ä¸º str[x - a,x - 1] éƒ¨åˆ†å­—ç¬¦ä¸ match[y - a ,y -1]å­—ç¬¦ç›¸ç­‰ï¼Œè¿™æ˜¯æˆ‘ä»¬åˆšç§»åŠ¨æŒ‡é’ˆä¸€æ­¥æ­¥åŒ¹é…åˆ° x,yä½ç½®æ‰å‘ç°ä¸ç›¸ç­‰ã€‚
                //æ‰€ä»¥ str[x - a,x - 1] ä¸ match [0...a-1] å­—ç¬¦ç›¸ç­‰ï¼Œç›´æ¥ä»  str[x] ä½ç½®ä¸ match[a] ä½ç½®å¼€å§‹æ¯”è¾ƒï¼Œè€Œä¸æ˜¯ä» match[0]
                //ä½ç½®å¼€å§‹æ¯”è¾ƒ
                y = next[y];
            }
        }
        return y == match.length ? x - y : -1;
    }


    /**
     * è·å– match å­—ç¬¦ä¸²çš„å‰ç¼€å’Œï¼š
     * å‰ç¼€å’Œçš„æ„æ€ï¼šç»™å®šå­—ç¬¦ä¸²"abcabctx"ï¼Œ0ä½ç½®è§„å®šä¸º-1,1ä½ç½®ä¸º0
     * 1.next[i]è¡¨ç¤º[0,i-1]çš„å­—ç¬¦çš„æœ€é•¿å‰ç¼€çš„é•¿åº¦ï¼š[0,i-1]ä¸­ï¼Œnext[4]çš„å‰ç¼€ä¸º"abca"
     * 2.å‰ç¼€ä¸º"abca",1.é•¿åº¦ä¸èƒ½è¶…è¿‡è‡ªèº«ï¼Œå‰ç¼€ä¸åå ç›¸ç­‰, 0-0:a å’Œ3-3:a æ‰€ä»¥next[4]ä½ç½®æœ€é•¿å‰ç¼€å’Œä¸º1
     * 3.next[5],"abcabc"æœ€é•¿å‰ç¼€å’Œï¼š0-1:abï¼Œ3-4ï¼šabï¼Œæ‰€ä»¥æœ€é•¿å‰ç¼€å’Œä¸º2
     * match:  "a  b  c  a  b  c  t  x"
     * next:  [-1, 0, 0, 0, 1, 2, 3, 0]
     */
    public static int[] getNextArray(char[] m) {
        if (m.length == 1) return new int[]{-1};
        int n = m.length;
        int[] next = new int[n];
        next[0] = -1;
        next[1] = 0;
        //å› ä¸º0,1ä½ç½®è§„å®šå‰ç¼€å’Œå°±æ˜¯-1,0,æ‰€ä»¥ä» i = 2 ä½ç½®å¼€å§‹
        int i = 2;
        //cn è¡¨ç¤º cn ä½ç½®çš„å­—ç¬¦ï¼Œæ˜¯å½“å‰ å’Œ i - 1ä½ç½®æ¯”è¾ƒçš„å­—ç¬¦
        int cn = 0;
        while (i < n) {
            if (m[cn] == m[i - 1]) {
                //å½“å‰å­—ç¬¦ç›¸ç­‰ï¼Œç§»åŠ¨æŒ‡é’ˆï¼Œè¯´æ˜å‰ç¼€å’ŒåŒ¹é…æˆåŠŸ
                cn++;
                next[i] = cn;
                i++;
                // i= 4æ—¶å€™ï¼Œms[0] = ms[3] = a,æ­¤æ—¶æ‰¾åˆ°iä½ç½®çš„å‰ç¼€å’Œä¸º1ï¼Œ
            } else if (cn > 0) {
                //     * match:  "a  b  c  a  b  c  t  x"
                //     * next:  [-1, 0, 0, 0, 1, 2, 3, 0]
                cn = next[cn];
            } else {
                //cnä¸º0äº†
                next[i++] = 0;
            }
        }
        return next;
    }

}
